<section
    class="chat-body"
    (click)="closePicker($event)"
>
    <div class="chat-header">
        <button
            mat-button
            (click)="openDialogChannelInfo()"
        >
            <img src="../../../assets/img/icons/chat-tag.svg" />
            <h1>{{ chatService.currentChannel.name }}</h1>
            <img src="../../../assets/img/icons/keyboard_arrow_down.svg" />
        </button>
        <div class="participants-wrapper">
            <button
                mat-icon-button
                (click)="openDialog($event)"
            >
                <div>
                    @for (i of [0, 1, 2]; track i) {
<<<<<<< HEAD
                    @if (chatService.currentChannel.members[i].avatar.length > 1) {
                    <img src="{{ chatService.currentChannel.members[i].avatar }}">
                    } @else {
                    <img src="../../../assets/img/avatar/{{ chatService.currentChannel.members[i].avatar}}.svg">
                    }
=======
                        @if (
                            chatService.currentChannel.members[i].avatar
                                .length > 1
                        ) {
                            <img
                                src="{{
                                    chatService.currentChannel.members[i].avatar
                                }}"
                            />
                        } @else {
                            <img
                                src="../../../assets/img/avatar/{{
                                    chatService.currentChannel.members[i].avatar
                                }}.svg"
                            />
                        }
>>>>>>> dd1182ae39c0fe257526954e5656841bec078cab
                    }
                </div>
                <h1>{{ chatService.currentChannel.members.length }}</h1>
            </button>
            <button
                mat-icon-button
                (click)="openDialogAddMembers($event)"
            >
                <img src="../../../assets/img/icons/person-add.svg" />
            </button>
        </div>
    </div>
    <div class="chat-content">
        @if (!emptyChannel()) {
<<<<<<< HEAD
        <div class="chat" #chatContainer>
            <!-- TODO: Add answers to thread amount -->
            @for (message of chatService.currentChannel.messages | keyvalue; track message; let i = $index) {
            @if (i == 0 || isLater(message.value.time, i - 1)) {
            <div class="day-date">
                <h2>{{ dayDate(message.value.time) }}</h2>
                <div class="vector"></div>
            </div>
            }
            <div *ngFor="let message of chatService.currentChannel.messages | keyvalue; let i = index" class="message"
                [ngClass]="{'my-message': message.value.id === currentUser.currentUser.id}">
                <div class="hoverMenu">
                    <button mat-icon-button>
                        <img src="../../../assets/img/icons/emoji-check.svg" alt="React">
                    </button>
                    <button mat-icon-button>
                        <img src="../../../assets/img/icons/emoji-hands-up.svg" alt="React">
                    </button>
                    <button (click)="toggleThread(chatService.currentChannelID, message.key)" mat-icon-button>
                        <img src="../../../assets/img/icons/comment.svg" alt="Comment">
                    </button>
                    <button mat-icon-button class="moreButton" [matMenuTriggerFor]="menu">
                        <img src="../../../assets/img/icons/3-dots.svg" alt="More">
                    </button>
                    <mat-menu class="moreMenu" #menu="matMenu">
                        <button mat-menu-item (click)="openDialogEditMessage(chatService.currentChannelID)">
                            Nachricht bearbeiten
                        </button>
                    </mat-menu>
                </div>

                @if (message.value.avatar.length > 1) {
                <img src="{{ message.value.avatar }}">
                } @else {
                <img src="../../../assets/img/avatar/{{ message.value.avatar }}.svg">
                }
                <div>
                    <div class="message-info">
                        <h5>{{ message.value.name }}</h5>
                        <span>{{ dayTime(message.value.time) }} Uhr</span>
                    </div>
                    <div #message class="message-text" (click)="onMessageClick($event)"
                        [innerHTML]="message.value.message | highlightMentions">

                    </div>
                    <div>
                        <div class="reaction">
                            @if(message.value.reactions) {
                            @for(reaction of message.value.reactions | keyvalue; track reaction; let i = $index) {
                            <div class="reaction-wrapper">
                                <div class="reaction-tooltip">
                                    <ngx-emoji [emoji]="reaction.key" style="font-size: 24px; height: 24px; width: 24px;"></ngx-emoji>
                                    <span>Name, Name</span>
                                    <p>hat reagiert</p>
                                </div>
                                <button mat-raised-button>
                                    <ngx-emoji emoji="smileys" style="font-size: 24px; height: 24px; width: 24px;"></ngx-emoji>
                                    <span>{{ reaction.value }}</span>
                                </button>
=======
            <div
                class="chat"
                #chatContainer
            >
                <!-- TODO: Add answers to thread amount -->
                @for (
                    message of chatService.currentChannel.messages | keyvalue;
                    track message;
                    let i = $index
                ) {
                    @if (i == 0 || isLater(message.value.time, i - 1)) {
                        <div class="day-date">
                            <h2>{{ dayDate(message.value.time) }}</h2>
                            <div class="vector"></div>
                        </div>
                    }
                    <div class="message">
                        <div class="hoverMenu">
                            <button mat-icon-button>
                                <img
                                    src="../../../assets/img/icons/emoji-check.svg"
                                    alt="React"
                                />
                            </button>
                            <button mat-icon-button>
                                <img
                                    src="../../../assets/img/icons/emoji-hands-up.svg"
                                    alt="React"
                                />
                            </button>
                            <button
                                (click)="
                                    toggleThread(
                                        chatService.currentChannelID,
                                        message.key
                                    )
                                "
                                mat-icon-button
                            >
                                <img
                                    src="../../../assets/img/icons/comment.svg"
                                    alt="Comment"
                                />
                            </button>
                            <button
                                mat-icon-button
                                class="moreButton"
                                [matMenuTriggerFor]="menu"
                            >
                                <img
                                    src="../../../assets/img/icons/3-dots.svg"
                                    alt="More"
                                />
                            </button>
                            <mat-menu
                                class="moreMenu"
                                #menu="matMenu"
                            >
                                <button
                                    mat-menu-item
                                    (click)="
                                        openDialogEditMessage(
                                            chatService.currentChannelID
                                        )
                                    "
                                >
                                    Nachricht bearbeiten
                                </button>
                            </mat-menu>
                        </div>

                        @if (message.value.avatar.length > 1) {
                            <img src="{{ message.value.avatar }}" />
                        } @else {
                            <img
                                src="../../../assets/img/avatar/{{
                                    message.value.avatar
                                }}.svg"
                            />
                        }
                        <div>
                            <div class="message-info">
                                <h5>{{ message.value.name }}</h5>
                                <span
                                    >{{ dayTime(message.value.time) }} Uhr</span
                                >
                            </div>
                            <div
                                #message
                                class="message-text"
                                (click)="onMessageClick($event)"
                                [innerHTML]="
                                    message.value.message | highlightMentions
                                "
                            ></div>
                            <div>
                                <div class="reaction">
                                    @if (message.value.reactions) {
                                        @for (
                                            reaction of message.value.reactions
                                                | keyvalue;
                                            track reaction;
                                            let i = $index
                                        ) {
                                            <div class="reaction-wrapper">
                                                <div class="reaction-tooltip">
                                                    <ngx-emoji
                                                        [emoji]="reaction.key"
                                                    ></ngx-emoji>
                                                    <span>{{reaction.key}}</span>
                                                    <span>{{message.value.name}}</span>
                                                    <p>hat reagiert</p>
                                                </div>
                                                <button mat-raised-button (click)="addOrSubReaction(message, reaction.key)">                                                    <ngx-emoji
                                                    [emoji]="reaction.key"
                                                ></ngx-emoji>
                                                <span>
                                                    {{reaction.key}}
                                            {{reaction.value}}</span></button>
                                            </div>
                                        }
                                    }
                                    <img
                                        src="../../../assets/img/icons/add_reaction.svg"
                                        alt="Add reaction"
                                        (click)="
                                            togglePicker(
                                                'reaction',
                                                message.value.padNumber
                                            );
                                            $event.stopPropagation()
                                        "
                                    />
                                </div>
>>>>>>> dd1182ae39c0fe257526954e5656841bec078cab
                            </div>
                            }
                            }
                            <img src="../../../assets/img/icons/add_reaction.svg" alt="Add reaction"
                                (click)="togglePicker('reaction', message.value.padNumber); $event.stopPropagation()">

                        </div>
                    </div>
                }
                <div
                    class="emoji-picker"
                    *ngIf="isPickerVisible && pickerContext === 'reaction'"
                >
                    <emoji-mart (emojiClick)="addEmoji($event)"></emoji-mart>
                </div>
<<<<<<< HEAD
            </div>
            }
            <div class="emoji-picker" *ngIf="isPickerVisible && pickerContext === 'reaction'">
                <emoji-mart (emojiClick)="addEmoji($event)"></emoji-mart>
            </div>


            <!-- TODO: add focus textarea on click -->
        </div>
        } @else {
        <div class="blank-chat">
            <div class="blank-info">
                <div>
                    <img src="../../../assets/img/icons/chat-tag.svg">
                    <h1>{{chatService.currentChannel.name}}</h1>
                </div>
                <span>
                    <button
                        (click)="openProfileCard(chatService.currentChannel.creator)">&#64;{{chatService.currentChannel.creator}}</button>
                    hat diesen Channel neu erstellt und das ist der Anfang des Channels.
                </span>
=======

                <!-- TODO: add focus textarea on click -->
            </div>
        } @else {
            <div class="blank-chat">
                <div class="blank-info">
                    <div>
                        <img src="../../../assets/img/icons/chat-tag.svg" />
                        <h1>{{ chatService.currentChannel.name }}</h1>
                    </div>
                    <span>
                        <button
                            (click)="
                                openProfileCard(
                                    chatService.currentChannel.creator
                                )
                            "
                        >
                            &#64;{{ chatService.currentChannel.creator }}
                        </button>
                        hat diesen Channel neu erstellt und das ist der Anfang
                        des Channels.
                    </span>
                </div>
>>>>>>> dd1182ae39c0fe257526954e5656841bec078cab
            </div>
        }
        <div class="input-container">
            <div class="chat-input">
<<<<<<< HEAD
                <textarea #messageInput matInput (input)="onInputChange($event)" [formControl]="formCtrl"
                    [matAutocomplete]="auto" type="text" (keydown)="onKeydown($event)" [(ngModel)]="messageText"
                    placeholder="Nachricht an #{{chatService.currentChannel.name}}"></textarea>
=======
                <textarea
                    #messageInput
                    matInput
                    (input)="onInputChange($event)"
                    [formControl]="formCtrl"
                    [matAutocomplete]="auto"
                    type="text"
                    (keydown)="onKeydown($event)"
                    [(ngModel)]="messageText"
                    placeholder="Nachricht an #{{
                        chatService.currentChannel.name
                    }}"
                ></textarea>
>>>>>>> dd1182ae39c0fe257526954e5656841bec078cab
                <div class="action-buttons">
                    <div class="button-wrapper">
                        <button
                            mat-icon-button
                        >
                            <img
                                src="../../../assets/img/icons/add-gray.svg"
                                alt="Add image"
                            />
                        </button>
                        <div class="vector"></div>
<<<<<<< HEAD
                        <button mat-icon-button (click)="togglePicker('input', ''); $event.stopPropagation()">
                            <img src="../../../assets/img/icons/sentiment_satisfied.svg" alt="Add emoji">
                        </button>

                        <div class="emoji-picker" *ngIf="isPickerVisible && pickerContext === 'input'">
                            <emoji-mart (emojiClick)="addEmoji($event)"></emoji-mart>
=======
                        <button
                            mat-icon-button
                            (click)="
                                togglePicker('input', '');
                                $event.stopPropagation()
                            "
                        >
                            <img
                                src="../../../assets/img/icons/sentiment_satisfied.svg"
                                alt="Add emoji"
                            />
                        </button>

                        <div
                            class="emoji-picker"
                            *ngIf="isPickerVisible && pickerContext === 'input'"
                        >
                            <emoji-mart
                                (emojiClick)="addEmoji($event)"
                            ></emoji-mart>
>>>>>>> dd1182ae39c0fe257526954e5656841bec078cab
                        </div>
                        <button
                            mat-icon-button
                            (click)="addAtSymbol()"
                        >
                            <img
                                src="../../../assets/img/icons/alternate_email.svg"
                                alt="Tag someone"
                            />
                        </button>
                    </div>
                    <button
                        (click)="send()"
                        mat-icon-button
                    >
                        <img
                            src="../../../assets/img/icons/send-button.svg"
                            alt="Send message"
                        />
                    </button>
                </div>
            </div>
            <mat-autocomplete
                #auto="matAutocomplete"
                (optionSelected)="selected($event)"
            >
                <mat-option
                    *ngFor="let option of filteredMembers | async"
                    [value]="option.name"
                >
                    @if (option.avatar && option.avatar.length > 1) {
<<<<<<< HEAD
                    <img src="{{ option.avatar }}">
                    } @else {
                    <img src="../../assets/img/avatar/{{ option.avatar}}.svg">
=======
                        <img src="{{ option.avatar }}" />
                    } @else {
                        <img
                            src="../../assets/img/avatar/{{
                                option.avatar
                            }}.svg"
                        />
>>>>>>> dd1182ae39c0fe257526954e5656841bec078cab
                    }
                    <h3>{{ option.name }}</h3>
                </mat-option>
            </mat-autocomplete>
        </div>
        <!-- TODO: Fix input buttons not working when focused -->
    </div>
</section>